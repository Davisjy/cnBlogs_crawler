<p><strong>1 &#x591A;&#x5A92;&#x4F53;&#x683C;&#x5F0F;&#x5316;&#x5668;</strong></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x53C8;&#x53EB;</span>MIME<span style="font-family: &#x5B8B;&#x4F53;">&#x7C7B;&#x578B;&#xFF0C;&#x6307;&#x793A;&#x4E86;&#x6570;&#x636E;&#x7684;&#x683C;&#x5F0F;&#x3002;&#x5728;</span>HTTP&#x534F;&#x8BAE;&#x4E2D;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x63CF;&#x8FF0;&#x4E86;&#x6D88;&#x606F;&#x4F53;&#x7684;&#x683C;&#x5F0F;&#x3002;&#x4E00;&#x4E2A;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x5305;&#x62EC;&#x4E24;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF1A;&#x7C7B;&#x578B;&#x548C;&#x5B50;&#x7C7B;&#x578B;&#x3002;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#x5982;&#xFF1A;</span></p>
<p>text/html<span style="font-family: &#x5B8B;&#x4F53;">&#x3001;</span>image/png<span style="font-family: &#x5B8B;&#x4F53;">&#x3001;</span>application/json<span style="font-family: &#x5B8B;&#x4F53;">&#x3001;</span>application/pdf<span style="font-family: &#x5B8B;&#x4F53;">&#x3002;</span></p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x8BF7;&#x6C42;&#x7684;</span>Content-Type<span style="font-family: &#x5B8B;&#x4F53;">&#x6807;&#x5934;&#x6307;&#x5B9A;&#x6D88;&#x606F;&#x4F53;&#x7684;&#x683C;&#x5F0F;&#xFF0C;&#x6307;&#x793A;&#x63A5;&#x6536;&#x8005;&#x5E94;&#x5982;&#x4F55;&#x89E3;&#x6790;&#x6D88;&#x606F;&#x4F53;&#x5185;&#x5BB9;&#x3002;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#x5982;&#xFF1A;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x8BF7;&#x6C42;&#x544A;&#x77E5;&#x670D;&#x52A1;&#x7AEF;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E3A;</span>HTML, XHTML, or XML</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x8BF7;&#x6C42;&#xFF1A;</span>Accept: text/html,application/xhtml+xml,application/xml</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x54CD;&#x5E94;&#xFF1A;</span></p>
<p>HTTP/1.1 200 OK</p>
<p>Content-Length: 95267</p>
<p>Content-Type: image/png</p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x4E3A;</span>Web Api<span style="font-family: &#x5B8B;&#x4F53;">&#x6307;&#x660E;&#x4E86;&#x5982;&#x4F55;&#x5E8F;&#x5217;&#x5316;&#x4E0E;&#x53CD;&#x5E8F;&#x5217;&#x5316;</span>HTTP<span style="font-family: &#x5B8B;&#x4F53;">&#x6D88;&#x606F;&#x4F53;&#x3002;</span>Web API<span style="font-family: &#x5B8B;&#x4F53;">&#x5185;&#x5EFA;&#x5BF9;</span>XML, JSON, BSON<span style="font-family: &#x5B8B;&#x4F53;">&#xFF0C;</span>form-urlencoded&#x652F;&#x6301;&#xFF0C;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x591A;&#x5A92;&#x4F53;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x6765;&#x81EA;&#x5B9A;&#x4E49;&#x683C;&#x5F0F;&#x5316;&#x65B9;&#x5F0F;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x7EE7;&#x627F;&#x81EA;MediaTypeFormatter<span style="font-family: &#x5B8B;&#x4F53;">&#x6216;</span>BufferedMediaTypeFormatter<span style="font-family: &#x5B8B;&#x4F53;">&#xFF0C;&#x5176;&#x4E2D;</span>MediaTypeFormatter<span style="font-family: &#x5B8B;&#x4F53;">&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x7684;&#x8BFB;&#x5199;&#x65B9;&#x6CD5;&#xFF0C;</span>BufferedMediaTypeFormatter<span style="font-family: &#x5B8B;&#x4F53;">&#x4F7F;&#x7528;&#x540C;&#x6B65;&#x7684;&#x8BFB;&#x5199;&#x65B9;&#x6CD5;&#x3002;</span></p>
<p><strong>&#xA0;</strong></p>
<p><strong><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;&#x521B;&#x5EFA;</span></strong><strong>CSV&#x683C;&#x5F0F;&#x5316;&#x5668;</strong></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;</span></p>
<div class="cnblogs_code">
<pre>    <span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span><span style="color: #000000"> Product
    {
        </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">int</span> Id { <span style="color: #0000ff">get</span>; <span style="color: #0000ff">set</span><span style="color: #000000">; }
        </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> Name { <span style="color: #0000ff">get</span>; <span style="color: #0000ff">set</span><span style="color: #000000">; }
        </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> Category { <span style="color: #0000ff">get</span>; <span style="color: #0000ff">set</span><span style="color: #000000">; }
        </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">decimal</span> Price { <span style="color: #0000ff">get</span>; <span style="color: #0000ff">set</span><span style="color: #000000">; }
    }</span></pre>
</div>
<p>&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x5B9A;&#x4E49;</span>ProductCsvFormatter<span style="font-family: &#x5B8B;&#x4F53;">&#xFF0C;&#x7EE7;&#x627F;&#x81EA;</span>BufferedMediaTypeFormatter</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span><span style="color: #000000"> ProductCsvFormatter : BufferedMediaTypeFormatter
{
    </span><span style="color: #0000ff">public</span><span style="color: #000000"> ProductCsvFormatter()
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> &#x6DFB;&#x52A0;&#x88AB;&#x652F;&#x6301;&#x7684;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;</span>
        SupportedMediaTypes.Add(<span style="color: #0000ff">new</span> MediaTypeHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">text/csv</span><span style="color: #800000">&quot;</span><span style="color: #000000">));
    }
}</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x91CD;&#x5199;</span>CanWriteType&#x65B9;&#x6CD5;&#xFF0C;&#x6307;&#x660E;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x53EF;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x7C7B;&#x578B;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">bool</span><span style="color: #000000"> CanWriteType(System.Type type)
{
    </span><span style="color: #008000">//</span><span style="color: #008000">&#x6307;&#x660E;&#xFFFD;&#xFFFD;&#x5E8F;&#x5217;&#x5316;Product</span>
    <span style="color: #0000ff">if</span> (type == <span style="color: #0000ff">typeof</span><span style="color: #000000">(Product))
{
        </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">true</span><span style="color: #000000">;
}
    </span><span style="color: #008000">//</span><span style="color: #008000">&#x6307;&#x660E;&#x53EF;&#x5E8F;&#x5217;&#x5316;IEnumerable&lt;Product&gt;</span>
    <span style="color: #0000ff">else</span><span style="color: #000000">
    {
        Type enumerableType </span>= <span style="color: #0000ff">typeof</span>(IEnumerable&lt;Product&gt;<span style="color: #000000">);
        </span><span style="color: #0000ff">return</span><span style="color: #000000"> enumerableType.IsAssignableFrom(type);
    }
}</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x91CD;&#x5199;</span>CanReadType&#x65B9;&#x6CD5;&#xFF0C;&#x6307;&#x660E;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x53EF;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x7684;&#x7C7B;&#x578B;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">bool</span><span style="color: #000000"> CanReadType(Type type)
{
    </span><span style="color: #008000">//</span><span style="color: #008000">&#x8BBE;&#x7F6E;&#x4E3A;&#x4E0D;&#x652F;&#x6301;&#x53CD;&#x5E8F;&#x5217;&#x5316;</span>
    <span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span><span style="color: #000000">;
}</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x91CD;&#x5199;</span>WriteToStream&#x65B9;&#x6CD5;<span style="font-family: &#x5B8B;&#x4F53;">&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C06;&#x5E8F;&#x5217;&#x5316;&#x6570;&#x636E;&#x5199;&#x5165;&#x6D41;&#xFF0C;&#x82E5;&#x8981;&#x652F;&#x6301;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x53EF;&#x91CD;&#x5199;</span>ReadFromStream&#x65B9;&#x6CD5;&#x3002;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> WriteToStream(Type type, <span style="color: #0000ff">object</span><span style="color: #000000"> value, Stream writeStream, HttpContent content)
{
    </span><span style="color: #0000ff">using</span> (<span style="color: #0000ff">var</span> writer = <span style="color: #0000ff">new</span><span style="color: #000000"> StreamWriter(writeStream))
    {
        </span><span style="color: #0000ff">var</span> products = value <span style="color: #0000ff">as</span> IEnumerable&lt;Product&gt;<span style="color: #000000">;
        </span><span style="color: #0000ff">if</span> (products != <span style="color: #0000ff">null</span><span style="color: #000000">)
        {
            </span><span style="color: #0000ff">foreach</span> (<span style="color: #0000ff">var</span> product <span style="color: #0000ff">in</span><span style="color: #000000"> products)
            {
                WriteItem(product, writer);
            }
        }
        </span><span style="color: #0000ff">else</span><span style="color: #000000">
        {
            </span><span style="color: #0000ff">var</span> singleProduct = value <span style="color: #0000ff">as</span><span style="color: #000000"> Product;
            </span><span style="color: #0000ff">if</span> (singleProduct == <span style="color: #0000ff">null</span><span style="color: #000000">)
            {
                </span><span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span> InvalidOperationException(<span style="color: #800000">&quot;</span><span style="color: #800000">Cannot serialize type</span><span style="color: #800000">&quot;</span><span style="color: #000000">);
            }
            WriteItem(singleProduct, writer);
        }
    }
}

</span><span style="color: #008000">//</span><span style="color: #008000"> &#x5E2E;&#x52A9;&#x65B9;&#x6CD5;</span>
<span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span><span style="color: #000000"> WriteItem(Product product, StreamWriter writer)
{
    writer.WriteLine(</span><span style="color: #800000">&quot;</span><span style="color: #800000">{0},{1},{2},{3}</span><span style="color: #800000">&quot;</span><span style="color: #000000">, Escape(product.Id),
        Escape(product.Name), Escape(product.Category), Escape(product.Price));
}

</span><span style="color: #0000ff">static</span> <span style="color: #0000ff">char</span>[] _specialChars = <span style="color: #0000ff">new</span> <span style="color: #0000ff">char</span>[] { <span style="color: #800000">&apos;</span><span style="color: #800000">,</span><span style="color: #800000">&apos;</span>, <span style="color: #800000">&apos;</span><span style="color: #800000">\n</span><span style="color: #800000">&apos;</span>, <span style="color: #800000">&apos;</span><span style="color: #800000">\r</span><span style="color: #800000">&apos;</span>, <span style="color: #800000">&apos;</span><span style="color: #800000">&quot;</span><span style="color: #800000">&apos;</span><span style="color: #000000"> };

</span><span style="color: #0000ff">private</span> <span style="color: #0000ff">string</span> Escape(<span style="color: #0000ff">object</span><span style="color: #000000"> o)
{
    </span><span style="color: #0000ff">if</span> (o == <span style="color: #0000ff">null</span><span style="color: #000000">)
    {
        </span><span style="color: #0000ff">return</span> <span style="color: #800000">&quot;&quot;</span><span style="color: #000000">;
    }
    </span><span style="color: #0000ff">string</span> field =<span style="color: #000000"> o.ToString();
    </span><span style="color: #0000ff">if</span> (field.IndexOfAny(_specialChars) != -<span style="color: #800080">1</span><span style="color: #000000">)
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Delimit the entire field with quotes and replace embedded quotes with &quot;&quot;.</span>
        <span style="color: #0000ff">return</span> String.Format(<span style="color: #800000">&quot;</span><span style="color: #800000">\&quot;{0}\&quot;</span><span style="color: #800000">&quot;</span>, field.Replace(<span style="color: #800000">&quot;</span><span style="color: #800000">\&quot;</span><span style="color: #800000">&quot;</span>, <span style="color: #800000">&quot;</span><span style="color: #800000">\&quot;\&quot;</span><span style="color: #800000">&quot;</span><span style="color: #000000">));
    }
    </span><span style="color: #0000ff">else</span> <span style="color: #0000ff">return</span><span style="color: #000000"> field;
}</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x5C06;&#x591A;&#x5A92;&#x4F53;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x6DFB;&#x52A0;&#x5230;</span>Web API&#x7BA1;&#x9053;&#xFF08;&#x65B9;&#x6CD5;&#x5728;WebApiConfig&#x7C7B;&#x4E2D;&#xFF09;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">void</span><span style="color: #000000"> Register(HttpConfiguration config)
{
    config.Formatters.Add(</span><span style="color: #0000ff">new</span><span style="color: #000000"> ProductCsvFormatter()); 
}</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><strong><span style="font-family: &#x5B8B;&#x4F53;">&#x5B57;&#x7B26;&#x7F16;&#x7801;</span></strong></p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x591A;&#x5A92;&#x4F53;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x652F;&#x6301;&#x591A;&#x79CD;&#x7F16;&#x7801;&#xFF0C;&#x4F8B;&#x5982;</span>UTF-8<span style="font-family: &#x5B8B;&#x4F53;">&#x6216;</span>ISO 8859-1<span style="font-family: &#x5B8B;&#x4F53;">&#x3002;</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span><span style="color: #000000"> ProductCsvFormatter()
{
    SupportedMediaTypes.Add(</span><span style="color: #0000ff">new</span> MediaTypeHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">text/csv</span><span style="color: #800000">&quot;</span><span style="color: #000000">));

    </span><span style="color: #008000">//</span><span style="color: #008000"> &#x65B0;&#x7684;&#x7F16;&#x7801;:</span>
    SupportedEncodings.Add(<span style="color: #0000ff">new</span> UTF8Encoding(encoderShouldEmitUTF8Identifier: <span style="color: #0000ff">false</span><span style="color: #000000">));
    SupportedEncodings.Add(Encoding.GetEncoding(</span><span style="color: #800000">&quot;</span><span style="color: #800000">iso-8859-1</span><span style="color: #800000">&quot;</span><span style="color: #000000">));
}</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x5728;</span>WriteToStream&#x65B9;&#x6CD5;&#x4E2D;&#x6DFB;&#x52A0;&#x9009;&#x62E9;&#x7F16;&#x7801;&#x65B9;&#x5F0F;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5982;&#x679C;&#x652F;&#x6301;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x90A3;&#x4E48;&#x5728;ReadFromStream&#x65B9;&#x6CD5;&#x4E2D;&#x540C;&#x6837;&#x6DFB;&#x52A0;&#x9009;&#x62E9;&#x7F16;&#x7801;&#x65B9;&#x5F0F;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> WriteToStream(Type type, <span style="color: #0000ff">object</span><span style="color: #000000"> value, Stream writeStream, HttpContent content)
{
    </span><span style="color: #008000">//</span><span style="color: #008000">&#x8C03;&#x7528;MediaTypeFormatter.SelectCharacterEncoding&#x9009;&#x62E9;&#x7F16;&#x7801;&#x65B9;&#x5F0F;&#xFF0C;&#x7531;&#x4E8E;ProductCsvFormatter&#x6D3E;&#x751F;&#x81EA;MediaTypeFormatter&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x5C31;&#x7EE7;&#x627F;&#x4E86;SelectCharacterEncoding&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;</span>
    Encoding effectiveEncoding =<span style="color: #000000"> SelectCharacterEncoding(content.Headers);

    </span><span style="color: #0000ff">using</span> (<span style="color: #0000ff">var</span> writer = <span style="color: #0000ff">new</span><span style="color: #000000"> StreamWriter(writeStream, effectiveEncoding))
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Write the object (code not shown)</span>
<span style="color: #000000">    }
}</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><strong>2 JSON&#x548C;XML&#x7684;&#x5E8F;&#x5217;&#x5316;</strong></p>
<p class="pre">Web API&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x53EF;&#x4EE5;&#x4ECE;HTTP&#x6D88;&#x606F;&#x4F53;&#x4E2D;&#x8BFB;&#x53D6;CLR&#x5BF9;&#x8C61;&#x6216;&#x5C06;CLR&#x5BF9;&#x8C61;&#x5199;&#x5165;&#x6D88;&#x606F;&#x4F53;&#x3002;Web API&#x6846;&#x67B6;&#x63D0;&#x4F9B;&#x4E86;JSON&#x683C;&#x5F0F;&#x5316;&#x5668;&#x548C;XML&#x683C;&#x5F0F;&#x5316;&#x5668;&#xFF0C;&#x9ED8;&#x8BA4;&#x652F;&#x6301;JSON&#x548C;XML&#x5E8F;&#x5217;&#x5316;&#x3002;&#x53EF;&#x4EE5;&#x5728;&#x8BF7;&#x6C42;&#x7684;Accept&#x9996;&#x90E8;&#x5B57;&#x6BB5;&#x6307;&#x5B9A;&#x63A5;&#x6536;&#x7684;&#x7C7B;&#x578B;&#x3002;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;&#x6307;&#x5B9A;&#x8FD4;&#x56DE;</span>JSON&#x5B57;&#x7B26;&#x4E32;</p>
<div class="cnblogs_code">
<pre>HttpContent content = <span style="color: #0000ff">new</span><span style="color: #000000"> StringContent(JsonConvert.SerializeObject(cont));
content.Headers.ContentType </span>= <span style="color: #0000ff">new</span> MediaTypeHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">application/json</span><span style="color: #800000">&quot;</span><span style="color: #000000">);
request.Content </span>=<span style="color: #000000"> content;
HttpResponseMessage response </span>= client.SendAsync(request).Result;</pre>
</div>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF1A;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;"><img src="https://images2018.cnblogs.com/blog/1024858/201804/1024858-20180410130931234-1980670400.png" alt=""></span></p>
<p class="pre">&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;&#x6307;&#x5B9A;&#x8FD4;&#x56DE;</span>XML&#x5B57;&#x7B26;&#x4E32;</p>
<div class="cnblogs_code">
<pre>HttpContent content = <span style="color: #0000ff">new</span><span style="color: #000000"> StringContent(JsonConvert.SerializeObject(cont));
content.Headers.ContentType </span>= <span style="color: #0000ff">new</span> MediaTypeHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">application/xml</span><span style="color: #800000">&quot;</span><span style="color: #000000">);
request.Content </span>=<span style="color: #000000"> content;
HttpResponseMessage response </span>= client.SendAsync(request).Result;</pre>
</div>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF1A;</span></p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;"><img src="https://images2018.cnblogs.com/blog/1024858/201804/1024858-20180410131039130-861815185.png" alt=""></span></p>
<p class="pre">&#xA0;</p>
<p class="pre"><strong>2.1 JSON<span style="font-family: &#x5B8B;&#x4F53;">&#x683C;&#x5F0F;&#x5316;&#x5668;</span></strong></p>
<p class="pre"><span style="font-family: &#xFFFD;&#xFFFD;&#x4F53;">&#x7C7B;</span>JsonMediaTypeFormatter<span style="font-family: &#x5B8B;&#x4F53;">&#x63D0;&#x4F9B;&#x5BF9;</span>JSON&#x6570;&#x636E;&#x7684;&#x683C;&#x5F0F;&#x5316;<span style="font-family: &#x5B8B;&#x4F53;">&#x3002;&#x9ED8;&#x8BA4;&#x5730;</span>JsonMediaTypeFormatter<span style="font-family: &#x5B8B;&#x4F53;">&#x4F7F;&#x7528;</span>Json.NET<span style="font-family: &#x5B8B;&#x4F53;">&#x6765;&#x683C;&#x5F0F;&#x5316;&#x6570;&#x636E;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;</span>DataContractJsonSerializer<span style="font-family: &#x5B8B;&#x4F53;">&#x6765;&#x683C;&#x5F0F;&#x5316;&#x6570;&#x636E;&#x3002;</span></p>
<p class="pre">var json = GlobalConfiguration.Configuration.Formatters.JsonFormatter;</p>
<p class="pre">json.UseDataContractJsonSerializer = true;</p>
<p class="pre"><strong>&#xA0;</strong></p>
<p class="pre"><strong><span style="font-family: &#x5B8B;&#x4F53;">&#x5E8F;&#x5217;&#x5316;</span></strong></p>
<ul>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x4F7F;&#x7528;</span>Json.NET&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x5730;&#x6240;&#x6709;&#x7684;&#x516C;&#x6709;&#x7C7B;&#x578B;&#x7684;&#x5B57;&#x6BB5;&#x548C;&#x5C5E;&#x6027;&#x90FD;&#x4F1A;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x9664;&#x975E;&#x6807;&#x8BB0;&#x4E86;JsonIgnore&#x7279;&#x6027;&#x3002;</li>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x53EF;&#x4EE5;&#x4F7F;&#x7528;</span>DataContract&#x7279;&#x6027;&#x6807;&#x8BB0;&#x6570;&#x636E;&#x6A21;&#x578B;&#xFF0C;&#x6807;&#x8BB0;&#x4E86;DataMember&#x7279;&#x6027;&#x7684;&#x5C5E;&#x6027;&#x90FD;&#x4F1A;<span style="font-family: &#x5B8B;&#x4F53;">&#x88AB;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x5373;&#x4F7F;&#x662F;&#x79C1;&#x6709;&#x7C7B;&#x578B;&#x3002;</span></li>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x53EA;&#x8BFB;&#x5C5E;&#x6027;&#x9ED8;&#x8BA4;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#x3002;</span></li>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x9ED8;&#x8BA4;&#x5730;&#xFF0C;</span>Json.NET&#x7684;&#x65F6;&#x95F4;&#x5B57;&#x7B26;&#x4E32;&#x4E3A;ISO 8601&#x683C;&#x5F0F;&#xFF0C;&#x5E76;&#x4FDD;&#x6301;&#x65F6;&#x533A;&#x3002;UTC&#x65F6;&#x95F4;&#x542B;&#x6709;&#x201C;Z&#x201D;&#x5B57;&#x7B26;&#x540E;&#x7F00;&#xFF0C;&#x672C;&#x5730;&#x65F6;&#x95F4;&#x5305;&#x62EC;&#x65F6;&#x533A;&#x504F;&#x79FB;&#x91CF;&#x3002;</li>
</ul>
<p class="pre">&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;&#x663E;&#x793A;&#x672C;&#x5730;&#x65F6;&#x95F4;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x63A7;&#x5236;&#x5668;</span></p>
<div class="cnblogs_code">
<pre><span style="color: #000000">        [HttpPost]
        </span><span style="color: #0000ff">public</span><span style="color: #000000"> IHttpActionResult ModelValid([FromBody]DataModel model)
        {
            </span><span style="color: #0000ff">new</span> TaskCompletionSource&lt;HttpResponseMessage&gt;<span style="color: #000000">();

            </span><span style="color: #0000ff">if</span> (!<span style="color: #000000">ModelState.IsValid)
            {
                </span><span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span><span style="color: #000000"> HttpResponseException(HttpStatusCode.BadRequest);
            }
            </span><span style="color: #0000ff">return</span><span style="color: #000000"> Ok(model);
        }</span></pre>
</div>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5BA2;&#x6237;&#x7AEF;&#x8C03;&#x7528;&#xFF1A;</span></p>
<div class="cnblogs_code">
<pre>            HttpClient client = <span style="color: #0000ff">new</span><span style="color: #000000"> HttpClient();
            </span><span style="color: #0000ff">string</span> url = <span style="color: #800000">&quot;</span><span style="color: #800000">http://localhost/WebApi_Test/api/account/modelvalid?Field1Name=1name&amp;Field2Name=2name</span><span style="color: #800000">&quot;</span><span style="color: #000000">;
            </span><span style="color: #0000ff">using</span> (HttpRequestMessage request = <span style="color: #0000ff">new</span><span style="color: #000000"> HttpRequestMessage(HttpMethod.Post, url))
            {
                </span><span style="color: #0000ff">var</span> cont = <span style="color: #0000ff">new</span> { DT=<span style="color: #000000">DateTime.Now};
                HttpContent content </span>= <span style="color: #0000ff">new</span><span style="color: #000000"> StringContent(JsonConvert.SerializeObject(cont));
                content.Headers.ContentType </span>= <span style="color: #0000ff">new</span> MediaTypeHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">application/json</span><span style="color: #800000">&quot;</span><span style="color: #000000">);
                request.Content </span>=<span style="color: #000000"> content;
                HttpResponseMessage response </span>=<span style="color: #000000"> client.SendAsync(request).Result;
                Console.WriteLine(</span><span style="color: #800000">&quot;</span><span style="color: #800000">&#x72B6;&#x6001;&#x7801;&#xFF1A;{0}</span><span style="color: #800000">&quot;</span>,(<span style="color: #0000ff">int</span><span style="color: #000000">)response.StatusCode);
                </span><span style="color: #0000ff">var</span> task =<span style="color: #000000"> response.Content.ReadAsStringAsync();
                task.Wait();
                Console.WriteLine(</span><span style="color: #800000">&quot;</span><span style="color: #800000">&#x7ED3;&#x679C;&#xFF1A;{0}</span><span style="color: #800000">&quot;</span><span style="color: #000000">, task.Result);
            }</span></pre>
</div>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x7ED3;&#x679C;&#xFF1A;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;"><img src="https://images2018.cnblogs.com/blog/1024858/201804/1024858-20180410131202005-1589368471.png" alt=""></span></p>
<ul>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x9ED8;&#x8BA4;&#x5730;&#xFF0C;</span>Json.NET&#x4FDD;&#x7559;&#x4E86;&#x65F6;&#x533A;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;DateTimeZoneHandling&#x8FD9;&#x4E00;&#x5C5E;&#x6027;&#x6539;&#x53D8;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x3002;</li>
</ul>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;</span></p>
<div class="cnblogs_code">
<pre><span style="color: #008000">//</span><span style="color: #008000"> &#x8F6C;&#x6362;&#x6240;&#x6709;&#x65E5;&#x671F;&#x4E3A; UTC</span>
<span style="color: #0000ff">var</span> json =<span style="color: #000000"> GlobalConfiguration.Configuration.Formatters.JsonFormatter;
json.SerializerSettings.DateTimeZoneHandling </span>= Newtonsoft.Json.DateTimeZoneHandling.Utc;</pre>
</div>
<ul>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x82E5;&#x60F3;&#x4F7F;&#x7528;</span>Microsoft JSON &#x65E5;&#x671F;&#x683C;&#x5F0F;&#xFF1A;</li>
</ul>
<p>&#x4F8B;&#xFF1A;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">var</span> json =<span style="color: #000000"> GlobalConfiguration.Configuration.Formatters.JsonFormatter;
json.SerializerSettings.DateFormatHandling 
</span>= Newtonsoft.Json.DateFormatHandling.MicrosoftDateFormat;</pre>
</div>
<ul>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x8BBE;&#x7F6E;</span>Formatting.Indented&#x6765;&#x652F;&#x6301;&#x7F29;&#x8FDB;&#x683C;&#x5F0F;</li>
</ul>
<p>&#x4F8B;&#xFF1A;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">var</span> json =<span style="color: #000000"> GlobalConfiguration.Configuration.Formatters.JsonFormatter;
json.SerializerSettings.Formatting </span>= Newtonsoft.Json.Formatting.Indented;</pre>
</div>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x63A7;&#x5236;&#x5668;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x8C03;&#x7528;&#x4E0E;&#x524D;&#x4F8B;&#x57FA;&#x672C;&#x4E00;&#x81F4;&#xFF0C;&#x7F29;&#x8FDB;&#x7684;&#x6548;&#x679C;&#x4E3A;&#xFF1A;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;"><img src="https://images2018.cnblogs.com/blog/1024858/201804/1024858-20180410131429650-1474793054.png" alt=""></span></p>
<ul>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x4E3A;&#x4E86;&#x4F7F;</span>JSON&#x5B57;&#x7B26;&#x4E32;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x5177;&#x6709;&#x9A7C;&#x5CF0;&#x5F0F;&#x7684;&#x98CE;&#x683C;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E3A;<span style="color: #000000">CamelCasePropertyNamesContractResolver</span></li>
</ul>
<p>&#x4F8B;&#xFF1A;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">var</span> json =<span style="color: #000000"> GlobalConfiguration.Configuration.Formatters.JsonFormatter;
json.SerializerSettings.ContractResolver </span>= <span style="color: #0000ff">new</span> CamelCasePropertyNamesContractResolver();</pre>
</div>
<ul>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x533F;&#x540D;&#x7C7B;&#x578B;&#x81EA;&#x52A8;&#x5E8F;&#x5217;&#x5316;&#x4E3A;</span>JSON</li>
</ul>
<p>&#x4F8B;&#xFF1A;<span style="font-family: &#x5B8B;&#x4F53;">&#x63A7;&#x5236;&#x5668;&#x64CD;&#x4F5C;&#x4E3A;</span>Get</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">object</span><span style="color: #000000"> Get()
{
    </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">new</span><span style="color: #000000"> { 
        Name </span>= <span style="color: #800000">&quot;</span><span style="color: #800000">Alice</span><span style="color: #800000">&quot;</span><span style="color: #000000">, 
        Age </span>= <span style="color: #800080">23</span><span style="color: #000000">, 
        Pets </span>= <span style="color: #0000ff">new</span> List&lt;<span style="color: #0000ff">string</span>&gt; { <span style="color: #800000">&quot;</span><span style="color: #800000">Fido</span><span style="color: #800000">&quot;</span>, <span style="color: #800000">&quot;</span><span style="color: #800000">Polly</span><span style="color: #800000">&quot;</span>, <span style="color: #800000">&quot;</span><span style="color: #800000">Spot</span><span style="color: #800000">&quot;</span><span style="color: #000000"> } 
    };
}</span></pre>
</div>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x8C03;&#x7528;&#x63A7;&#x5236;&#x5668;&#x83B7;&#x5F97;&#x54CD;&#x5E94;&#x4E2D;&#x5305;&#x542B;&#xFF1A;</span>{&quot;Name&quot;:&quot;Alice&quot;,&quot;Age&quot;:23,&quot;Pets&quot;:[&quot;Fido&quot;,&quot;Polly&quot;,&quot;Spot&quot;]}</p>
<p class="pre">&#xA0;</p>
<p class="pre"><strong>2.2 XML&#x683C;&#x5F0F;&#x5316;&#x5668;</strong></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x7C7B;</span>XmlMediaTypeFormatter &#x63D0;&#x4F9B;&#x5BF9;XML&#x6570;&#x636E;&#x7684;&#x683C;&#x5F0F;&#x5316;&#x3002;&#x9ED8;&#x8BA4;&#x5730;&#xFF0C;&#x4F7F;&#x7528;DataContractSerializer&#x6267;&#x884C;&#x5E8F;&#x5217;&#x5316;&#x3002;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x53EF;&#x8BBE;&#x7F6E;&#x4F7F;&#x7528;</span>XmlSerializer&#x6765;&#x6267;&#x884C;&#x5E8F;&#x5217;&#x5316;&#x3002;XmlSerializer<span style="font-family: &#x5B8B;&#x4F53;">&#x652F;&#x6301;&#x7684;&#x7C7B;&#x578B;&#x6BD4;</span>DataContractSerializer<span style="font-family: &#x5B8B;&#x4F53;">&#x5C11;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x5BF9;</span>XML&#x7ED3;&#x679C;&#x505A;&#x66F4;&#x591A;&#x5730;&#x63A7;&#x5236;&#x3002;</p>
<p>var xml = GlobalConfiguration.Configuration.Formatters.XmlFormatter;</p>
<p>xml.UseXmlSerializer = true;</p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x9ED8;&#x8BA4;&#x5730;</span>DataContractSerializer<span style="font-family: &#x5B8B;&#x4F53;">&#x884C;&#x4E3A;&#x5982;&#x4E0B;&#xFF1A;</span></p>
<p>1&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x6240;&#x6709;&#x7684;&#x516C;&#x6709;&#x7C7B;&#x578B;&#x5C5E;&#x6027;&#x6216;&#x5B57;&#x6BB5;&#x90FD;&#x4F1A;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#xFF08;</span>set&#x548C;get&#x4E0D;&#x52A0;&#x4FEE;&#x9970;<span style="font-family: &#x5B8B;&#x4F53;">&#xFF09;&#xFF0C;&#x53EF;&#x4F7F;&#x7528;</span>IgnoreDataMember&#x7279;&#x6027;&#x5C06;&#x5176;&#x6392;&#x9664;&#x5728;&#x5916;&#x3002;</p>
<p>2&#xFF09;Private<span style="font-family: &#x5B8B;&#x4F53;">&#x548C;</span>protected<span style="font-family: &#x5B8B;&#x4F53;">&#x6210;&#x5458;&#x4E0D;&#x4F1A;&#x5E8F;&#x5217;&#x5316;&#x3002;</span></p>
<p>3&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x53EA;&#x8BFB;&#x5C5E;&#x6027;&#x4E0D;&#x4F1A;&#x5E8F;&#x5217;&#x5316;&#xFF0C;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x4F46;&#x53EA;&#x8BFB;&#x7684;&#x96C6;&#x5408;&#x5C5E;&#x6027;&#x4F1A;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#x3002;</span></p>
<p>4&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x7C7B;&#x53CA;&#x5176;&#x6210;&#x5458;&#x540D;&#x79F0;</span><span style="font-family: &#xFFFD;&#xFFFD;&#x4F53;">&#x5982;&#x5176;&#x5B9A;&#x4E49;&#x65F6;&#x6240;&#x663E;&#x793A;&#x7684;&#x90A3;&#x6837;&#xFF0C;&#x4E0D;&#x52A0;&#x6539;&#x53D8;&#x5730;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x88AB;&#x5199;&#x5165;</span>XML&#x4E2D;&#x3002;</p>
<p>5&#xFF09;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x7684;XML&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x3002;</p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x82E5;&#x60F3;&#x8981;&#x65BD;&#x52A0;&#x66F4;&#x591A;&#x7684;&#x63A7;&#x5236;&#x90A3;&#x4E48;&#x4F7F;&#x7528;</span>DataContract&#x4FEE;&#x9970;&#x7C7B;&#xFF0C;&#x4F7F;&#x7528;DataMember&#x4FEE;&#x9970;&#x5176;&#x5C5E;&#x6027;&#x3002;&#x5E8F;&#x5217;&#x5316;&#x89C4;&#x5219;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>1&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x4F7F;&#x7528;</span>DataMember<span style="font-family: &#x5B8B;&#x4F53;">&#x7279;&#x6027;&#x4FEE;&#x9970;&#x6210;&#x5458;&#x4F7F;&#x5176;&#x53EF;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x5373;&#x4F7F;&#x7C7B;&#x5C5E;&#x6027;&#x4E3A;&#x79C1;&#x6709;&#x5C5E;&#x6027;&#x4E5F;&#x53EF;&#x5C06;&#x5176;&#x5E8F;&#x5217;&#x5316;&#x3002;</span></p>
<p>2&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x5BF9;&#x4E8E;&#x4F7F;&#x7528;</span>DataContract&#x7279;&#x6027;&#x4FEE;&#x9970;&#x7684;&#x7C7B;&#xFF0C;&#x82E5;&#x4E0D;&#x5BF9;&#x5176;&#x5C5E;&#x6027;&#x6210;&#x5458;&#x4F7F;&#x7528;DataMember&#x7279;&#x6027;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x4E0D;&#x80FD;&#x5E8F;&#x5217;&#x5316;&#x3002;</p>
<p>3&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x53EA;&#x8BFB;&#x5C5E;&#x6027;&#x4E0D;&#x4F1A;&#x88AB;&#x5E8F;&#x5217;&#x5316;&#x3002;</span></p>
<p>4&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x5728;</span>DataContract&#x4E2D;&#x8BBE;&#x7F6E;Name&#x5C5E;&#x6027;&#x6765;&#x6307;&#x5B9A;&#x7C7B;&#x5728;XML&#x4E2D;&#x7684;&#x540D;&#x79F0;&#x3002;</p>
<p>5&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x5728;</span>DataContract&#x4E2D;&#x8BBE;&#x7F6E;NameSpace&#x5C5E;&#x6027;&#x6765;&#x6307;&#x5B9A;XML&#x540D;&#x79F0;&#x7A7A;&#x95F4;&#x3002;</p>
<p>6&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x5728;</span>DataMember&#x4E2D;&#x8BBE;&#x7F6E;Name&#x5C5E;&#x6027;&#x6765;&#x6307;&#x5B9A;&#x7C7B;&#x5C5E;&#x6027;&#x5728;XML&#x4E2D;&#x7684;&#x540D;&#x79F0;&#x3002;</p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x65F6;&#x95F4;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x7C7B;&#x578B;&#x4F1A;&#x5E8F;&#x5217;&#x5316;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x4E3A;</span>ISO 8601<span style="font-family: &#x5B8B;&#x4F53;">&#x683C;&#xFFFD;&#xFFFD;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x7684;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x5B57;&#x7B26;&#x4E32;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x3002;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F7F;&#x7528;</span>Indent&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;<span style="font-family: &#x5B8B;&#x4F53;">&#x7F29;&#x8FDB;&#x683C;&#x5F0F;</span></p>
<p>var xml = GlobalConfiguration.Configuration.Formatters.XmlFormatter;</p>
<p>xml.Indent = true;</p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4E3A;&#x4E0D;&#x540C;&#x7684;</span>CLR<span style="font-family: &#x5B8B;&#x4F53;">&#x7C7B;&#x578B;&#x8BBE;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x683C;&#x5F0F;&#x5316;&#x5668;</span></p>
<p>var xml = GlobalConfiguration.Configuration.Formatters.XmlFormatter;</p>
<p>// &#x5C06;XmlSerializer &#x5E94;&#x7528;&#x4E8E;Product&#x7C7B;</p>
<p>xml.SetSerializer&lt;Product&gt;(new XmlSerializer(typeof(Product)));</p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x79FB;&#x9664;</span>JSON&#x6216;XML&#x683C;&#x5F0F;&#x5316;&#x5668;&#xFF0C;<span style="font-family: &#x5B8B;&#x4F53;">&#x5728;</span>Register&#x4E2D;&#x6DFB;&#x52A0;<span style="font-family: &#x5B8B;&#x4F53;">&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x3002;</span></p>
<p>// Remove the JSON formatter</p>
<p>config.Formatters.Remove(config.Formatters.JsonFormatter);</p>
<p>// Remove the XML formatter</p>
<p>config.Formatters.Remove(config.Formatters.XmlFormatter);</p>
<p>&#xA0;</p>
<p><strong>2.3&#x63A7;&#x5236;&#x7C7B;&#x7684;&#x5FAA;&#x73AF;&#x5F15;&#x7528;&#xFF08;&#x5E94;&#x907F;&#x514D;&#x5FAA;&#x73AF;&#x5F15;&#x7528;&#xFF09;</strong></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span><span style="color: #000000"> Employee
{
    </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> Name { <span style="color: #0000ff">get</span>; <span style="color: #0000ff">set</span><span style="color: #000000">; }
    </span><span style="color: #0000ff">public</span> Department Department { <span style="color: #0000ff">get</span>; <span style="color: #0000ff">set</span><span style="color: #000000">; }
}

</span><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span><span style="color: #000000"> Department
{
    </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> Name { <span style="color: #0000ff">get</span>; <span style="color: #0000ff">set</span><span style="color: #000000">; }
    </span><span style="color: #0000ff">public</span> Employee Manager { <span style="color: #0000ff">get</span>; <span style="color: #0000ff">set</span><span style="color: #000000">; }
}

</span><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span><span style="color: #000000"> DepartmentsController : ApiController
{
    </span><span style="color: #0000ff">public</span> Department Get(<span style="color: #0000ff">int</span><span style="color: #000000"> id)
    {
        Department sales </span>= <span style="color: #0000ff">new</span> Department() { Name = <span style="color: #800000">&quot;</span><span style="color: #800000">Sales</span><span style="color: #800000">&quot;</span><span style="color: #000000"> };
        Employee alice </span>= <span style="color: #0000ff">new</span> Employee() { Name = <span style="color: #800000">&quot;</span><span style="color: #800000">Alice</span><span style="color: #800000">&quot;</span>, Department =<span style="color: #000000"> sales };
        sales.Manager </span>=<span style="color: #000000"> alice;
        </span><span style="color: #0000ff">return</span><span style="color: #000000"> sales;
    }
}</span></pre>
</div>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x6587;&#x4EF6;</span>Global.asax<span style="font-family: &#x5B8B;&#x4F53;">&#x4E2D;&#x7684;</span>Application_Start<span style="font-family: &#x5B8B;&#x4F53;">&#x65B9;&#x6CD5;&#x4E2D;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4EE3;&#x7801;&#xFF0C;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x5982;&#x679C;&#x4E0D;&#x6DFB;&#x52A0;&#x4E0B;&#x8FF0;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x65F6;&#x4F1A;&#x62A5;</span>500&#x9519;&#x8BEF;&#x3002;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">var</span> json =<span style="color: #000000"> GlobalConfiguration.Configuration.Formatters.JsonFormatter;
json.SerializerSettings.PreserveReferencesHandling </span>=<span style="color: #000000"> 
    Newtonsoft.Json.PreserveReferencesHandling.All;</span></pre>
</div>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x7ED3;&#x679C;&#x4E3A;&#xFF1A;</span>{&quot;$id&quot;:&quot;1&quot;,&quot;Name&quot;:&quot;Sales&quot;,&quot;Manager&quot;:{&quot;$id&quot;:&quot;2&quot;,&quot;Name&quot;:&quot;Alice&quot;,&quot;Department&quot;:{&quot;$ref&quot;:&quot;1&quot;}}}</p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5BF9;&#x4E8E;</span>XML&#x5FAA;&#x73AF;&#x5F15;&#x7528;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x6709;&#x4E24;&#x79CD;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#x3002;&#x4E00;&#x662F;&#x5728;&#x6A21;&#x578B;&#x4E0A;&#x5E94;&#x7528;[DataContract(IsReference=true)]&#x7279;&#x6027;&#xFF0C;&#x4E8C;&#x662F;&#x4E3A;DataContractSerializer&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x53C2;&#x6570;preserveObjectReferences&#x8D4B;&#x503C;&#x4E3A;true&#x3002;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">var</span> xml =<span style="color: #000000"> GlobalConfiguration.Configuration.Formatters.XmlFormatter;
</span><span style="color: #0000ff">var</span> dcs = <span style="color: #0000ff">new</span> DataContractSerializer(<span style="color: #0000ff">typeof</span>(Department), <span style="color: #0000ff">null</span>, <span style="color: #0000ff">int</span><span style="color: #000000">.MaxValue, 
    </span><span style="color: #0000ff">false</span>, <span style="color: #008000">/*</span><span style="color: #008000"> preserveObjectReferences: </span><span style="color: #008000">*/</span> <span style="color: #0000ff">true</span>, <span style="color: #0000ff">null</span><span style="color: #000000">);
xml.SetSerializer</span>&lt;Department&gt;(dcs);</pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><strong>3 ASP.NET Web API 2.1&#x652F;&#x6301;BSON</strong></p>
<p class="pre">BSON<span style="font-family: &#x5B8B;&#x4F53;">&#x662F;&#x4E8C;&#x8FDB;&#x5236;&#x5E8F;&#x5217;&#x5316;&#x683C;&#x5F0F;&#xFF0C;&#x4E0E;</span>JSON&#x5927;&#x5C0F;&#x76F8;&#x8FD1;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E8C;&#x8FDB;&#x5236;&#x7684;&#x6587;&#x4EF6;&#x5E8F;&#x5217;&#x5316;&#x540E;&#x6BD4;JSON&#x5C0F;&#x3002;BSON&#x6570;&#x636E;&#x6613;&#x6269;&#x5C55;&#xFF0C;&#x56E0;&#x4E3A;&#x5143;&#x7D20;&#x5E26;&#x6709;&#x957F;&#x5EA6;&#x5B57;&#x6BB5;&#x524D;&#x7F00;&#x3002;&#x89E3;&#x6790;&#x5668;&#x80FD;&#x591F;&#x8DF3;&#x8FC7;&#x5143;&#x7D20;&#x800C;&#x4E0D;&#x5BF9;&#x6570;&#x636E;&#x89E3;&#x7801;&#x3002;&#x7F16;&#x7801;&#x548C;&#x89E3;&#x7801;&#x662F;&#x9AD8;&#x6548;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x503C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x88AB;&#x5B58;&#x50A8;&#x4E3A;&#x6570;&#x5B57;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5B57;&#x7B26;&#x4E32;&#x3002;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;&#x4E0D;&#x652F;&#x6301;</span>BOSN&#x7684;&#x8C03;&#x7528;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">var</span> cont = <span style="color: #0000ff">new</span> { Field1Name = <span style="color: #800000">&quot;</span><span style="color: #800000">1name</span><span style="color: #800000">&quot;</span>, Field2Name = <span style="color: #800000">&quot;</span><span style="color: #800000">2name</span><span style="color: #800000">&quot;</span>, DT=<span style="color: #000000">DateTime.Now};
HttpContent content </span>= <span style="color: #0000ff">new</span><span style="color: #000000"> StringContent(JsonConvert.SerializeObject(cont));
content.Headers.ContentType </span>= <span style="color: #0000ff">new</span> MediaTypeHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">application/bson</span><span style="color: #800000">&quot;</span><span style="color: #000000">);
request.Content </span>=<span style="color: #000000"> content;
HttpResponseMessage response </span>= client.SendAsync(request).Result;</pre>
</div>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x7ED3;&#x679C;&#xFF1A;</span></p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;"><img src="https://images2018.cnblogs.com/blog/1024858/201804/1024858-20180410132504513-1674389986.png" alt=""></span></p>
<p class="pre">&#xA0;</p>
<p class="pre"><strong><span style="font-family: &#x5B8B;&#x4F53;">&#x542F;&#x7528;</span>BSON&#x683C;&#x5F0F;&#x5316;&#x5668;</strong></p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x8BBE;&#x7F6E;&#x652F;&#x6301;</span>BSON&#xFF0C;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x7684;Content-Type<span style="font-family: &#x5B8B;&#x4F53;">&#x4E3A;</span>application/bson<span style="font-family: &#x5B8B;&#x4F53;">&#x65F6;&#xFF0C;</span>Web API&#x4F1A;&#x4F7F;&#x7528;BSON&#x683C;&#x5F0F;&#x5316;&#x5668;&#x3002;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">class</span><span style="color: #000000"> WebApiConfig
{
    </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">void</span><span style="color: #000000"> Register(HttpConfiguration config)
    {
        config.Formatters.Add(</span><span style="color: #0000ff">new</span><span style="color: #000000"> BsonMediaTypeFormatter());

        </span><span style="color: #008000">//</span><span style="color: #008000"> &#x5176;&#x4ED6;&#x914D;&#x7F6E;</span>
<span style="color: #000000">    }
}</span></pre>
</div>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4E3A;&#x4E86;&#x5173;&#x8054;&#x5176;&#x4ED6;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x4E0E;</span>BOSN&#xFF0C;&#x5E94;&#x5982;&#x4E0B;&#x8BBE;&#x7F6E;&#xFF0C;&#x4F8B;&#x5982;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x4E3A;&#x201C;application/<span style="color: #000000">vnd.contoso&#x201D;</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">var</span> bson = <span style="color: #0000ff">new</span><span style="color: #000000"> BsonMediaTypeFormatter();
bson.SupportedMediaTypes.Add(</span><span style="color: #0000ff">new</span> MediaTypeHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">application/vnd.contoso</span><span style="color: #800000">&quot;</span><span style="color: #000000">));
config.Formatters.Add(bson);</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;</span>.NET<span style="font-family: &#x5B8B;&#x4F53;">&#x5BA2;&#x6237;&#x7AEF;&#x5E94;&#x7528;</span>HttpClient<span style="font-family: &#x5B8B;&#x4F53;">&#x4F7F;&#x7528;</span>BSON&#x683C;&#x5F0F;&#x5316;&#x5668;&#x3002;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">static</span> <span style="color: #0000ff">async</span><span style="color: #000000"> Task RunAsync()
{
    </span><span style="color: #0000ff">using</span> (HttpClient client = <span style="color: #0000ff">new</span><span style="color: #000000"> HttpClient())
    {
        client.BaseAddress </span>= <span style="color: #0000ff">new</span> Uri(<span style="color: #800000">&quot;</span><span style="color: #800000">http://localhost</span><span style="color: #800000">&quot;</span><span style="color: #000000">);

        </span><span style="color: #008000">//</span><span style="color: #008000"> &#x8BBE;&#x7F6E;Accept&#x5934;.</span>
<span style="color: #000000">        client.DefaultRequestHeaders.Accept.Clear();
        client.DefaultRequestHeaders.Accept.Add(</span><span style="color: #0000ff">new</span> MediaTypeWithQualityHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">application/bson</span><span style="color: #800000">&quot;</span><span style="color: #000000">));

        </span><span style="color: #008000">//</span><span style="color: #008000"> &#x53D1;&#x9001;&#x8BF7;&#x6C42;</span>
        result = <span style="color: #0000ff">await</span> client.GetAsync(<span style="color: #800000">&quot;</span><span style="color: #800000">api/books/1</span><span style="color: #800000">&quot;</span><span style="color: #000000">);
        result.EnsureSuccessStatusCode();

        </span><span style="color: #008000">//</span><span style="color: #008000"> &#x4F7F;&#x7528;BSON&#x683C;&#x5F0F;&#x5316;&#x5668;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x7ED3;&#x679C;</span>
        MediaTypeFormatter[] formatters = <span style="color: #0000ff">new</span><span style="color: #000000"> MediaTypeFormatter[] {
            </span><span style="color: #0000ff">new</span><span style="color: #000000"> BsonMediaTypeFormatter()
        };

        </span><span style="color: #0000ff">var</span> book = <span style="color: #0000ff">await</span> result.Content.ReadAsAsync&lt;Book&gt;<span style="color: #000000">(formatters);
    }
}</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x53D1;&#x9001;</span>post&#x8BF7;&#x6C42;&#xFF1A;</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">static</span> <span style="color: #0000ff">async</span><span style="color: #000000"> Task RunAsync()
{
    </span><span style="color: #0000ff">using</span> (HttpClient client = <span style="color: #0000ff">new</span><span style="color: #000000"> HttpClient())
    {
        client.BaseAddress </span>= <span style="color: #0000ff">new</span> Uri(<span style="color: #800000">&quot;</span><span style="color: #800000">http://localhost:15192</span><span style="color: #800000">&quot;</span><span style="color: #000000">);

        </span><span style="color: #008000">//</span><span style="color: #008000"> &#x8BBE;&#x7F6E;&#x8BF7;&#x6C42;&#x5934;Content-Type&#x4E3A;application/bson</span>
<span style="color: #000000">        client.DefaultRequestHeaders.Accept.Clear();
        client.DefaultRequestHeaders.Accept.Add(</span><span style="color: #0000ff">new</span> MediaTypeWithQualityHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">application/bson</span><span style="color: #800000">&quot;</span><span style="color: #000000">));

        </span><span style="color: #0000ff">var</span> book = <span style="color: #0000ff">new</span><span style="color: #000000"> Book()
        {
            Author </span>= <span style="color: #800000">&quot;</span><span style="color: #800000">Jane Austen</span><span style="color: #800000">&quot;</span><span style="color: #000000">,
            Title </span>= <span style="color: #800000">&quot;</span><span style="color: #800000">Emma</span><span style="color: #800000">&quot;</span><span style="color: #000000">,
            Price </span>= <span style="color: #800080">9.95M</span><span style="color: #000000">,
            PublicationDate </span>= <span style="color: #0000ff">new</span> DateTime(<span style="color: #800080">1815</span>, <span style="color: #800080">1</span>, <span style="color: #800080">1</span><span style="color: #000000">)
        };

        </span><span style="color: #008000">//</span><span style="color: #008000"> &#x4F7F;&#x7528;BSON&#x683C;&#x5F0F;&#x5316;&#x5668;</span>
        MediaTypeFormatter bsonFormatter = <span style="color: #0000ff">new</span><span style="color: #000000"> BsonMediaTypeFormatter();
        </span><span style="color: #0000ff">var</span> result = <span style="color: #0000ff">await</span> client.PostAsync(<span style="color: #800000">&quot;</span><span style="color: #800000">api/books</span><span style="color: #800000">&quot;</span><span style="color: #000000">, book, bsonFormatter);
        result.EnsureSuccessStatusCode();
    }
}</span></pre>
</div>
<p class="pre">&#xA0;</p>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;&#x672A;&#x53CD;&#x5E8F;&#x5217;&#x5316;</span>BSON&#x7ED3;&#x679C;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5BA2;&#x6237;&#x7AEF;&#x8C03;&#x7528;</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">            using</span>(HttpClient client = <span style="color: #0000ff">new</span><span style="color: #000000"> HttpClient())
            {
                client.DefaultRequestHeaders.Accept.Clear();
                client.DefaultRequestHeaders.Accept.Add(</span><span style="color: #0000ff">new</span> MediaTypeWithQualityHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">application/bson</span><span style="color: #800000">&quot;</span><span style="color: #000000">));

                </span><span style="color: #0000ff">string</span> url = <span style="color: #800000">&quot;</span><span style="color: #800000">http://localhost/WebApi_Test/api/account/modelvalid?Field1Name=1name&amp;Field2Name=2name</span><span style="color: #800000">&quot;</span><span style="color: #000000">;
                </span><span style="color: #0000ff">using</span> (HttpRequestMessage request = <span style="color: #0000ff">new</span><span style="color: #000000"> HttpRequestMessage(HttpMethod.Post, url))
                {
                    </span><span style="color: #0000ff">var</span> cont = <span style="color: #0000ff">new</span> { Field1Name = <span style="color: #800000">&quot;</span><span style="color: #800000">1name</span><span style="color: #800000">&quot;</span>, Field2Name = <span style="color: #800000">&quot;</span><span style="color: #800000">2name</span><span style="color: #800000">&quot;</span>, DT =<span style="color: #000000"> DateTime.Now };
                    HttpContent content </span>= <span style="color: #0000ff">new</span><span style="color: #000000"> StringContent(JsonConvert.SerializeObject(cont));
                    content.Headers.ContentType </span>= <span style="color: #0000ff">new</span> MediaTypeHeaderValue(<span style="color: #800000">&quot;</span><span style="color: #800000">application/json</span><span style="color: #800000">&quot;</span><span style="color: #000000">);
                    request.Content </span>=<span style="color: #000000"> content;
                    HttpResponseMessage response </span>=<span style="color: #000000"> client.SendAsync(request).Result;
                    Console.WriteLine(</span><span style="color: #800000">&quot;</span><span style="color: #800000">&#x72B6;&#x6001;&#x7801;&#xFF1A;{0}</span><span style="color: #800000">&quot;</span>, (<span style="color: #0000ff">int</span><span style="color: #000000">)response.StatusCode);
                    </span><span style="color: #0000ff">var</span> task =<span style="color: #000000"> response.Content.ReadAsStringAsync();
                    task.Wait();
                    Console.WriteLine(</span><span style="color: #800000">&quot;</span><span style="color: #800000">&#x7ED3;&#x679C;&#xFF1A;{0}</span><span style="color: #800000">&quot;</span><span style="color: #000000">, task.Result);
                }

                Console.Read();
            }</span></pre>
</div>
<p class="pre"><span style="font-family: &#x65B0;&#x5B8B;&#x4F53;">&#x7ED3;&#x679C;&#xFF1A;</span></p>
<p class="pre"><span style="font-family: &#x65B0;&#x5B8B;&#x4F53;"><img src="https://images2018.cnblogs.com/blog/1024858/201804/1024858-20180410132737282-1355460973.png" alt=""></span></p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5BA2;&#x6237;&#x7AEF;&#x5E8F;&#x5217;&#x5316;&#xFF0C;&#x53EA;&#x8981;&#x6539;&#x53D8;&#x5904;&#x7406;</span>HTTP<span style="font-family: &#x5B8B;&#x4F53;">&#x54CD;&#x5E94;&#x65B9;&#x5F0F;&#x5373;&#x53EF;&#xFF1A;</span></p>
<div class="cnblogs_code">
<pre>MediaTypeFormatter[] formatters = <span style="color: #0000ff">new</span><span style="color: #000000"> MediaTypeFormatter[] 
{
     </span><span style="color: #0000ff">new</span><span style="color: #000000"> BsonMediaTypeFormatter()
};

</span><span style="color: #0000ff">var</span> task = response.Content.ReadAsAsync&lt;DataModel&gt;<span style="color: #000000">(formatters);
task.Wait();
</span><span style="color: #0000ff">var</span> model =  task.Result;</pre>
</div>
<p>&#x518D;&#x6B21;&#x8FD0;&#x884C;&#x83B7;&#x5F97;<span style="font-family: &#x65B0;&#x5B8B;&#x4F53;">&#x7ED3;&#x679C;&#xFF1A;</span></p>
<p><span style="font-family: &#x65B0;&#x5B8B;&#x4F53;"><img src="https://images2018.cnblogs.com/blog/1024858/201804/1024858-20180410132855403-579746384.png" alt=""></span></p>
<p class="pre">&#xA0;</p>
<p class="pre"><strong><span style="font-family: &#x5B8B;&#x4F53;">&#x5E8F;&#x5217;&#x5316;&#x9876;&#x7EA7;&#x539F;&#x59CB;&#x7C7B;&#x578B;</span></strong></p>
<p class="pre">BOSN&#x8BED;&#x6CD5;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x89C4;&#x5B9A;&#x5982;&#x4F55;&#x5E8F;&#x5217;&#x5316;&#x9876;&#x7EA7;&#x539F;&#x59CB;&#x7C7B;&#x578B;&#xFF0C;&#x6BD4;&#x5982;int&#x7C7B;&#x578B;&#xFF0C;&#x4E3A;&#x4E86;&#x7A81;&#x7834;&#x8FD9;&#x4E00;&#x9650;&#x5236;&#xFF0C;BsonMediaTypeFormatter&#x5C06;&#x9876;&#x7EA7;&#x539F;&#x59CB;&#x7C7B;&#x578B;&#x89C6;&#x4E3A;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x5728;&#x5E8F;&#x5217;&#x5316;&#x4E4B;&#x524D;&#x5C06;&#x503C;&#x8F6C;&#x6362;&#x4E3A;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x952E;&#x4E3A;&#x201C;Value&#x201D;&#x3002;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#xFF1A;</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span><span style="color: #000000"> ValuesController : ApiController
{
    </span><span style="color: #0000ff">public</span><span style="color: #000000"> IHttpActionResult Get()
    {
        </span><span style="color: #0000ff">return</span> Ok(<span style="color: #800080">42</span><span style="color: #000000">);
    }
}</span></pre>
</div>
<p class="pre"><span style="font-family: &#x5B8B;&#x4F53;">&#x5E8F;&#x5217;&#x5316;&#x540E;&#x7684;&#x503C;&#x4E3A;&#xFF1A;</span>{ &quot;Value&quot;: 42 }</p>
<p class="pre">&#xA0;</p>
<p class="pre"><strong>4 &#x5185;&#x5BB9;&#x534F;&#x5546;</strong></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5728;</span>HTTP<span style="font-family: &#x5B8B;&#x4F53;">&#x4E2D;&#x4E3B;&#x8981;&#x7684;&#x5185;&#x5BB9;&#x534F;&#xFFFD;&#xFFFD;&#xFFFD;&#x673A;&#x5236;&#x5305;&#x62EC;&#x5982;&#x4E0B;&#x7684;&#x8BF7;&#x6C42;&#x5934;&#xFF1A;</span></p>
<p>Accept&#xFF1A;&#x5E94;&#x7B54;&#x4E2D;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#xFF0C;&#x5982;&quot;application/json,&quot; &quot;application/xml,&quot;</p>
<p>Accept-Charset<span style="font-family: &#x5B8B;&#x4F53;">&#xFF1A;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#x5B57;&#x7B26;&#xFF0C;&#x5982;</span>UTF-8<span style="font-family: &#x5B8B;&#x4F53;">&#x6216;</span>ISO 8859-1<span style="font-family: &#x5B8B;&#x4F53;">&#x3002;</span></p>
<p>Accept-Encoding<span style="font-family: &#x5B8B;&#x4F53;">&#xFF1A;&#x53EF;&#x63A5;&#x53D7;&#x7684;&#x7F16;&#x7801;&#x65B9;&#x5F0F;&#xFF0C;&#x5982;</span>gzip<span style="font-family: &#x5B8B;&#x4F53;">&#x3002;</span></p>
<p>Accept-Language<span style="font-family: &#x5B8B;&#x4F53;">&#xFF1A;&#x9996;&#x5148;&#x7684;&#x81EA;&#x7136;&#x8BED;&#x8A00;&#xFF0C;&#x5982;</span>en-us<span style="font-family: &#x5B8B;&#x4F53;">&#x3002;</span></p>
<p>X-Requested-With<span style="font-family: &#x5B8B;&#x4F53;">&#xFF1A;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x670D;&#x52A1;&#x5668;&#x636E;&#x6B64;&#x5224;&#x65AD;&#x8BF7;&#x6C42;&#x662F;&#x5426;&#x6765;&#x81EA;&#x4E8E;</span>AJAX&#x3002;</p>
<p>&#xA0;</p>
<p><strong><span style="font-family: &#x5B8B;&#x4F53;">&#x5E8F;&#x5217;&#x5316;</span></strong></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5982;&#x679C;</span>Web API<span style="font-family: &#x5B8B;&#x4F53;">&#x7684;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x63A7;&#x5236;&#x5668;&#x64CD;&#x4F5C;&#xFF08;</span>Action&#xFF09;<span style="font-family: &#x5B8B;&#x4F53;">&#x8FD4;&#x56DE;</span>CLR<span style="font-family: &#x5B8B;&#x4F53;">&#x7C7B;&#x578B;&#xFF0C;&#x7BA1;&#x9053;&#x5E8F;&#x5217;&#x5316;&#x8FD4;&#x56DE;&#x503C;&#x5E76;&#x5C06;&#x5176;&#x5199;&#x5165;</span>HTTP<span style="font-family: &#x5B8B;&#x4F53;">&#x54CD;&#x5E94;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x6D88;&#x606F;&#x4F53;&#x3002;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#x5982;&#xFF1A;</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> Product GetProduct(<span style="color: #0000ff">int</span><span style="color: #000000"> id)
{
    </span><span style="color: #0000ff">var</span> item = _products.FirstOrDefault(p =&gt; p.ID ==<span style="color: #000000"> id);
    </span><span style="color: #0000ff">if</span> (item == <span style="color: #0000ff">null</span><span style="color: #000000">)
    {
        </span><span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span><span style="color: #000000"> HttpResponseException(HttpStatusCode.NotFound);
    }
    </span><span style="color: #0000ff">return</span><span style="color: #000000"> item; 
}</span></pre>
</div>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x53D1;&#x9001;&#x7684;&#x8BF7;&#x6C42;&#x5982;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D;&#x8BF7;&#x6C42;&#x63A5;&#x6536;</span>JSON&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5373;&#x901A;&#x8FC7;Accept: application/json&#x6765;&#x6307;&#x5B9A;&#x7684;&#x3002;</p>
<p>GET http://localhost.:21069/api/products/1 HTTP/1.1</p>
<p>Host: localhost.:21069</p>
<p>Accept: application/json, text/javascript, */*; q=0.01</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x54CD;&#x5E94;&#x4E3A;&#xFF1A;</span></p>
<p>HTTP/1.1 200 OK</p>
<p>Content-Type: application/json; charset=utf-8</p>
<p>Content-Length: 57</p>
<p>Connection: Close</p>
<p>&#xA0;</p>
<p>{&quot;Id&quot;:1,&quot;Name&quot;:&quot;Gizmo&quot;,&quot;Category&quot;:&quot;Widgets&quot;,&quot;Price&quot;:1.99}</p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4E5F;&#x53EF;&#x8FD4;&#x56DE;</span>HttpResponseMessage<span style="font-family: &#x5B8B;&#x4F53;">&#x7C7B;&#x578B;&#xFF1A;</span></p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff">public</span> HttpResponseMessage GetProduct(<span style="color: #0000ff">int</span><span style="color: #000000"> id)
{
    </span><span style="color: #0000ff">var</span> item = _products.FirstOrDefault(p =&gt; p.ID ==<span style="color: #000000"> id);
    </span><span style="color: #0000ff">if</span> (item == <span style="color: #0000ff">null</span><span style="color: #000000">)
    {
        </span><span style="color: #0000ff">throw</span> <span style="color: #0000ff">new</span><span style="color: #000000"> HttpResponseException(HttpStatusCode.NotFound);
    }
    </span><span style="color: #0000ff">return</span><span style="color: #000000"> Request.CreateResponse(HttpStatusCode.OK, product);
}</span></pre>
</div>
<p>&#xA0;</p>
<p><strong><span style="font-family: &#x5B8B;&#x4F53;">&#x5185;&#x5BB9;&#x534F;&#x5546;&#x5DE5;&#x4F5C;&#x539F;&#x7406;</span></strong></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x9996;&#x9009;&#xFF0C;</span><span style="font-family: &#x5B8B;&#x4F53;">&#x7BA1;&#x9053;&#x4ECE;</span>HttpConfiguration<span style="font-family: &#x5B8B;&#x4F53;">&#x5BF9;&#x8C61;&#x4E2D;&#x83B7;&#x5F97;</span>IContentNegotiator<span style="font-family: &#x5B8B;&#x4F53;">&#xFF0C;&#x5E76;&#x4ECE;</span>HttpConfiguration.Formatters&#x96C6;&#x5408;&#x4E2D;&#x83B7;&#x5F97;&#x591A;&#x5A92;&#x4F53;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x5217;&#x8868;&#x3002;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x7136;&#x540E;&#xFF0C;&#x7BA1;&#x9053;&#x8C03;&#x7528;</span>IContentNegotiatior.Negotiate&#xFF0C;&#x4F20;&#x5165;&#x5F85;&#x5E8F;&#x5217;&#x5316;&#x7C7B;&#x578B;&#x3001;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x96C6;&#x5408;&#x3001;HTTP&#x8BF7;&#x6C42;&#x3002;Negotiate&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x4E24;&#x6761;&#x4FE1;&#x606F;&#xFF0C;&#x4E00;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x54EA;&#x4E2A;&#x683C;&#x5F0F;&#x5316;&#x5668;&#xFF0C;&#x4E8C;&#x662F;&#x54CD;&#x5E94;&#x9700;&#x8981;&#x7684;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x3002;&#x5982;&#x679C;&#x6240;&#x9700;&#x7684;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x6CA1;&#x6709;&#x627E;&#x5230;&#xFF0C;&#x90A3;&#x4E48;Negotiate&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;NULL&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x63A5;&#x53D7;&#x5230;406&#xFF08;&#x4E0D;&#x63A5;&#x53D7;&#xFF0C;&#x8BF7;&#x6C42;&#x8D44;&#x6E90;&#x4E0D;&#x53EF;&#x8BBF;&#x95EE;&#xFF09;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#xA0;</p>
<p><strong><span style="font-family: &#x5B8B;&#x4F53;">&#x9ED8;&#x8BA4;&#x7684;&#x5185;&#x5BB9;&#x534F;&#x5546;&#x673A;&#x5236;</span></strong></p>
<p>DefaultContentNegotiator<span style="font-family: &#x5B8B;&#x4F53;">&#x662F;</span>IContentNegotiator<span style="font-family: &#x5B8B;&#x4F53;">&#x9ED8;&#x8BA4;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x9009;&#x62E9;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x7684;&#x51C6;&#x5219;&#x4E3A;&#xFF1A;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x9996;&#x5148;&#xFF0C;&#x4F7F;&#x7528;</span>MediaTypeFormatter.CanWriteType&#x6765;&#x9A8C;&#x8BC1;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x662F;&#x5426;&#x80FD;&#x591F;&#x5E8F;&#x5217;&#x5316;&#x5F85;&#x5904;&#x7406;&#x7684;&#x7C7B;&#x578B;&#x3002;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5176;&#x6B21;&#xFF0C;&#x5185;&#x5BB9;&#x534F;&#x5546;&#x8005;&#x4F1A;&#x67E5;&#x770B;&#x6BCF;&#x4E2A;&#x683C;&#x5F0F;&#x5316;&#x5668;&#xFF0C;&#x5E76;&#x8BC4;&#x4F30;&#x5176;&#x4E0E;</span>HTTP&#x8BF7;&#x6C42;&#x7684;&#x5339;&#x914D;&#x7A0B;&#x5EA6;&#x3002;&#x4E3A;&#x4E86;&#x8BC4;&#x4F30;&#x5339;&#x914D;&#x7A0B;&#x5EA6;&#xFF0C;&#x5185;&#x5BB9;&#x534F;&#x5546;&#x4F1A;&#x505A;&#x4E24;&#x4EF6;&#x4E8B;&#x3002;</p>
<ul>
<li><span style="font-family: &#x5B8B;&#x4F53;">&#x96C6;&#x5408;</span>SupportedMediaTypes&#x5305;&#x542B;&#x4E86;&#x88AB;&#x652F;&#x6301;&#x7684;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#xFF0C;&#x5185;&#x5BB9;&#x534F;&#x5546;&#x8005;&#x4F9D;&#x636E;&#x8BF7;&#x6C42;&#x5934;&#x7684;Accept<span style="font-family: &#x5B8B;&#x4F53;">&#x6807;&#x5934;&#x6765;&#x5339;&#x914D;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x3002;</span>Accept<span style="font-family: &#x5B8B;&#x4F53;">&#x6807;&#x5934;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x8303;&#x56F4;&#xFF0C;&#x4F8B;&#x5982;</span>&quot;text/plain&quot; <span style="font-family: &#x5B8B;&#x4F53;">&#x53EF;&#x4EE5;&#x5339;&#x914D;</span>&#xA0;text/* <span style="font-family: &#x5B8B;&#x4F53;">&#x6216;</span>*/*<span style="font-family: &#x5B8B;&#x4F53;">&#x3002;</span></li>
<li>MediaTypeMapping&#x7C7B;&#x63D0;&#x4F9B;&#x4E86;&#x5339;&#x914D;HTTP&#x8BF7;&#x6C42;&#x7684;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x7684;&#x4E00;&#x822C;&#x65B9;&#x6CD5;&#x3002;&#x4F8B;&#x5982;&#x5B83;&#x53EF;&#x4EE5;&#x5339;&#x914D;&#x81EA;&#x5B9A;&#x7684;HTTP&#x8BF7;&#x6C42;&#x5934;&#x5230;&#x7279;&#x5B9A;&#x7684;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x3002;</li>
</ul>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;&#x5339;&#x914D;&#xFF0C;&#x90A3;&#x4E48;&#x9009;&#x53D6;&#x8D28;&#x91CF;&#x56E0;&#x6570;&#x6700;&#x9AD8;&#x7684;&#x4E00;&#x4E2A;&#x5339;&#x914D;&#x3002;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x4F8B;&#x5982;&#xFF1A;</span></p>
<p>Accept: application/json, application/xml; q=0.9, */*; q=0.1</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x9009;&#x53D6;&#x8D28;&#x91CF;&#x56E0;&#x6570;&#x4E3A;</span>0.9&#x7684;&#xFF0C;&#x5373;application/json&#x3002;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5339;&#x914D;&#xFF0C;&#x5185;&#x5BB9;&#x534F;&#x5546;&#x8005;&#x8BD5;&#x56FE;&#x5339;&#x914D;&#x8BF7;&#x6C42;&#x6D88;&#x606F;&#x4F53;&#x7684;&#x591A;&#x5A92;&#x4F53;&#x7C7B;&#x578B;&#x3002;</span></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5982;&#x679C;&#x8BF7;&#x6C42;&#x5305;&#x542B;</span>JSON&#x683C;&#x5F0F;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5185;&#x5BB9;&#x534F;&#x5546;&#x8005;&#x4F1A;&#x67E5;&#x627E;JSON&#x683C;&#x5F0F;&#x5316;&#x5668;&#x3002;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x5982;&#x679C;&#x901A;&#x8FC7;&#x4EE5;&#x4E0A;&#x89C4;&#x5219;&#x8FD8;&#x662F;&#x65E0;&#x6CD5;&#x5339;&#x914D;&#xFF0C;&#x5185;&#x5BB9;&#x534F;&#x5546;&#x8005;&#x4F1A;&#x9009;&#x62E9;&#x7B2C;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x5E8F;&#x5217;&#x5316;&#x5F85;&#x5904;&#x7406;&#x7C7B;&#x578B;&#x7684;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x3002;</span></p>
<p>&#xA0;</p>
<p><strong><span style="font-family: &#x5B8B;&#x4F53;">&#x5B57;&#x7B26;&#x7F16;&#x7801;&#x65B9;&#x5F0F;</span></strong></p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x9009;&#x597D;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x4EE5;&#x540E;&#xFF0C;&#x5185;&#x5BB9;&#x534F;&#x5546;&#x8005;&#x4F1A;&#x9009;&#x53D6;&#x6700;&#x597D;&#x7684;&#x5B57;&#x7B26;&#x7F16;&#x7801;&#x65B9;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7;&#x67E5;&#x770B;&#x683C;&#x5F0F;&#x5316;&#x5668;&#x7684;</span>SupportedEncodings&#x5C5E;&#x6027;&#xFF0C;&#x5E76;&#x4E0E;&#x8BF7;&#x6C42;&#x7684;Accept-Charset<span style="font-family: &#x5B8B;&#x4F53;">&#x6807;&#x5934;&#x503C;&#x8FDB;&#x884C;&#x5339;&#x914D;&#x3002;</span></p>
<p>&#xA0;</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x53C2;&#x8003;&#xFF1A;</span></p>
<p>https://docs.microsoft.com/en-us/aspnet/web-api/</p>
<p><span style="font-family: &#x5B8B;&#x4F53;">&#x90E8;&#x5206;&#x793A;&#x4F8B;&#x6765;&#x81EA;&#x4E8E;&#x8BE5;&#x7F51;&#x7AD9;</span></p>
<p>&#xA0;</p>
<p>---------------------------------------------------------------------</p>
<p>&#x8F6C;&#x8F7D;&#x4E0E;&#x5F15;&#x7528;&#x8BF7;&#x6CE8;&#x660E;&#x51FA;&#x5904;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x4ED3;&#x4FC3;&#xFF0C;&#x6C34;&#x5E73;&#x6709;&#x9650;&#xFF0C;&#x5982;&#x6709;&#x4E0D;&#x5F53;&#x4E4B;&#x5904;&#xFF0C;&#x6B22;&#x8FCE;&#x6307;&#x6B63;&#x3002;</p>